<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESODI - Authentification</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --whatsapp-color: #25D366;
            --shadow-light: 0 3px 10px rgba(0, 0, 0, 0.08);
            --shadow-medium: 0 5px 15px rgba(0, 0, 0, 0.1);
            --shadow-heavy: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }
        
        .container {
            width: 100%;
            max-width: 450px;
        }
        
        .login-container {
            background-color: white;
            padding: 30px 25px;
            border-radius: 12px;
            box-shadow: var(--shadow-medium);
            text-align: center;
        }
        
        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .logo i {
            background: var(--light-color);
            padding: 12px;
            border-radius: 50%;
            color: var(--secondary-color);
        }
        
        .subtitle {
            color: var(--secondary-color);
            font-size: 1.1rem;
            margin-bottom: 25px;
        }
        
        .form-group {
            margin-bottom: 18px;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark-color);
            font-size: 0.95rem;
        }
        
        .input-icon {
            position: relative;
        }
        
        .input-icon i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary-color);
            font-size: 16px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 12px 12px 40px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--secondary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .login-btn {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 14px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 3px 8px rgba(52, 152, 219, 0.3);
            margin-top: 10px;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(52, 152, 219, 0.4);
        }
        
        .login-btn i {
            margin-right: 8px;
        }
        
        .error-message {
            color: var(--accent-color);
            margin-top: 12px;
            padding: 8px;
            background: #ffeaea;
            border-radius: 4px;
            display: none;
            font-size: 0.9rem;
        }
        
        .dashboard {
            display: none;
            width: 100%;
            max-width: 1200px;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-medium);
            margin-bottom: 25px;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .dashboard-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-color);
        }
        
        .dashboard-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 8px 0;
        }
        
        .dashboard-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }
        
        .form-container {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--shadow-medium);
            position: relative;
        }
        
        .form-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            border-radius: 12px 12px 0 0;
        }
        
        .clients-container {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--shadow-medium);
        }
        
        .section-title {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-section {
            margin-bottom: 18px;
        }
        
        .filter-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .clients-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .client-card {
            background: var(--light-color);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .client-name {
            font-weight: bold;
            margin-bottom: 4px;
            color: var(--primary-color);
        }
        
        .client-details {
            font-size: 0.85rem;
            color: #666;
        }
        
        .empty-state {
            text-align: center;
            padding: 25px;
            color: #999;
        }
        
        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 12px;
            color: #ddd;
        }
        
        .gps-section {
            background: #e8f5e9;
            padding: 12px;
            border-radius: 6px;
            margin: 12px 0;
            border-left: 4px solid var(--success-color);
        }
        
        .gps-section h4 {
            color: var(--success-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }
        
        .gps-coordinates {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .gps-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 10px 12px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
            justify-content: center;
            font-size: 0.9rem;
        }
        
        .gps-btn:hover {
            background: #27ae60;
        }
        
        .gps-status {
            margin-top: 8px;
            font-style: italic;
            color: #666;
            font-size: 0.85rem;
            text-align: center;
        }
        
        .gps-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        
        .whatsapp-btn {
            background: linear-gradient(135deg, var(--whatsapp-color) 0%, #1ebe5d 100%);
            color: white;
            border: none;
            padding: 14px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 3px 8px rgba(37, 211, 102, 0.3);
            margin-top: 10px;
        }
        
        .whatsapp-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(37, 211, 102, 0.4);
        }
        
        .whatsapp-btn i {
            margin-right: 8px;
        }
        
        .btn-group {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 18px;
        }
        
        /* Am√©liorations pour les tr√®s petits √©crans */
        @media (max-width: 360px) {
            .login-container {
                padding: 20px 15px;
            }
            
            .logo {
                font-size: 1.8rem;
            }
            
            .logo i {
                padding: 10px;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .dashboard-header {
                padding: 15px;
            }
            
            .form-container, .clients-container {
                padding: 20px 15px;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
        }
        
        /* Am√©liorations pour les √©crans moyens */
        @media (min-width: 481px) and (max-width: 768px) {
            .dashboard-content {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                grid-template-columns: 1fr 1fr;
            }
            
            .gps-coordinates {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        /* Am√©liorations pour les grands √©crans */
        @media (min-width: 769px) {
            .dashboard-content {
                grid-template-columns: 1fr 350px;
            }
            
            .btn-group {
                grid-template-columns: 1fr 1fr;
            }
            
            .gps-coordinates {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        /* Am√©liorations pour l'accessibilit√© mobile */
        @media (max-width: 480px) {
            input, select, textarea {
                font-size: 16px; /* Emp√™che le zoom automatique sur iOS */
            }
            
            .login-btn, .whatsapp-btn {
                min-height: 48px; /* Taille minimale pour le toucher */
            }
        }
        
        /* Am√©lioration pour la r√©duction des mouvements */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .login-btn:hover, .whatsapp-btn:hover, .logout-btn:hover, .gps-btn:hover {
                transform: none;
            }
        }
        
        /* Am√©lioration du contraste pour l'accessibilit√© */
        .login-btn, .whatsapp-btn, .gps-btn {
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        /* Am√©lioration du focus pour navigation au clavier */
        .login-btn:focus, .whatsapp-btn:focus, .logout-btn:focus, 
        .gps-btn:focus, input:focus, select:focus, textarea:focus {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }
        
        /* Scrollbar personnalis√©e pour les navigateurs mobiles */
        .clients-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .clients-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .clients-list::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border-radius: 10px;
        }
        
        .clients-list::-webkit-scrollbar-thumb:hover {
            background: #2980b9;
        }
    </style>
</head>
<body>
    <!-- √âcran de connexion -->
    <div class="container" id="loginContainer">
        <div class="login-container">
            <div class="logo">
                <i class="fas fa-digital-tachograph"></i>
                ESODI
            </div>
            <div class="subtitle">√âcosyst√®me de Solutions Digitales</div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Identifiant</label>
                    <div class="input-icon">
                        <i class="fas fa-user"></i>
                        <input type="text" id="username" placeholder="Votre identifiant" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="password">Mot de passe</label>
                    <div class="input-icon">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="password" placeholder="Votre mot de passe" required>
                    </div>
                </div>
                
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Se connecter
                </button>
                
                <div class="error-message" id="errorMessage">
                    Identifiant ou mot de passe incorrect
                </div>
            </form>
        </div>
    </div>
    
    <!-- Tableau de bord apr√®s connexion -->
    <div class="dashboard" id="dashboard">
        <div class="dashboard-header">
            <div class="dashboard-title">
                <div class="logo">
                    <i class="fas fa-digital-tachograph"></i>
                    ESODI
                </div>
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="userDisplayName">Agent ESODI</span>
                    <button class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> D√©connexion
                    </button>
                </div>
            </div>
            <div class="subtitle">Tableau de bord Agent Commercial</div>
            
            <div class="stats">
                <div class="stat-card">
                    <div>Clients ce mois</div>
                    <div class="stat-value" id="clientsThisMonth">0</div>
                </div>
                <div class="stat-card">
                    <div>Total clients</div>
                    <div class="stat-value" id="totalClients">0</div>
                </div>
                <div class="stat-card">
                    <div>Services actifs</div>
                    <div class="stat-value" id="activeServices">0</div>
                </div>
            </div>
        </div>
        
        <div class="dashboard-content">
            <div class="form-container">
                <h2 class="section-title">
                    <i class="fas fa-user-plus"></i>
                    Nouveau Client
                </h2>
                
                <form id="clientForm">
                    <div class="form-group">
                        <label for="clientNom">Nom du client</label>
                        <div class="input-icon">
                            <i class="fas fa-user"></i>
                            <input type="text" id="clientNom" required placeholder="Nom du client">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="clientPrenom">Pr√©nom du client</label>
                        <div class="input-icon">
                            <i class="fas fa-user"></i>
                            <input type="text" id="clientPrenom" required placeholder="Pr√©nom du client">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="clientWhatsApp">WhatsApp</label>
                        <div class="input-icon">
                            <i class="fab fa-whatsapp"></i>
                            <input type="text" id="clientWhatsApp" required placeholder="+229 XX XX XX XX">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="clientEmail">Email</label>
                        <div class="input-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="clientEmail" placeholder="client@exemple.com">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="clientEtablissement">√âtablissement/Soci√©t√©</label>
                        <div class="input-icon">
                            <i class="fas fa-building"></i>
                            <input type="text" id="clientEtablissement" required placeholder="Nom de l'√©tablissement">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="clientAdresse">Adresse de l'√©tablissement</label>
                        <div class="input-icon">
                            <i class="fas fa-map-marker-alt"></i>
                            <textarea id="clientAdresse" rows="2" placeholder="Adresse compl√®te de l'√©tablissement"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="clientService">Service offert</label>
                        <div class="input-icon">
                            <i class="fas fa-cogs"></i>
                            <select id="clientService" required>
                                <option value="">S√©lectionnez un service</option>
                                <option value="Site Web">Site Web</option>
                                <option value="Application Mobile">Application Mobile</option>
                                <option value="Marketing Digital">Marketing Digital</option>
                                <option value="Formation">Formation</option>
                                <option value="Conseil">Conseil</option>
                                <option value="Solution ERP">Solution ERP</option>
                                <option value="Autre">Autre</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Section G√©olocalisation -->
                    <div class="gps-section">
                        <h4><i class="fas fa-map-location-dot"></i> Localisation GPS de l'√©tablissement</h4>
                        
                        <div class="gps-coordinates">
                            <div class="form-group">
                                <label for="latitude">Latitude</label>
                                <div class="input-icon">
                                    <i class="fas fa-globe"></i>
                                    <input type="text" id="latitude" readonly placeholder="Obtenue automatiquement">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="longitude">Longitude</label>
                                <div class="input-icon">
                                    <i class="fas fa-globe"></i>
                                    <input type="text" id="longitude" readonly placeholder="Obtenue automatiquement">
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" class="gps-btn" id="getLocationBtn">
                            <i class="fas fa-satellite"></i> Obtenir la position actuelle
                        </button>
                        
                        <div class="gps-status" id="gpsStatus">
                            Cliquez pour obtenir les coordonn√©es GPS automatiquement
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button type="submit" class="login-btn">
                            <i class="fas fa-save"></i> Sauvegarder
                        </button>
                        
                        <button type="button" class="whatsapp-btn" id="sendWhatsAppBtn">
                            <i class="fab fa-whatsapp"></i> Envoyer par WhatsApp
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="clients-container">
                <h2 class="section-title">
                    <i class="fas fa-users"></i>
                    Clients enregistr√©s
                </h2>
                
                <div class="filter-section">
                    <select class="filter-select" id="monthFilter">
                        <option value="all">Tous les mois</option>
                        <option value="0">Janvier</option>
                        <option value="1">F√©vrier</option>
                        <option value="2">Mars</option>
                        <option value="3">Avril</option>
                        <option value="4">Mai</option>
                        <option value="5">Juin</option>
                        <option value="6">Juillet</option>
                        <option value="7">Ao√ªt</option>
                        <option value="8">Septembre</option>
                        <option value="9">Octobre</option>
                        <option value="10">Novembre</option>
                        <option value="11">D√©cembre</option>
                    </select>
                </div>
                
                <div class="clients-list" id="clientsList">
                    <div class="empty-state">
                        <i class="fas fa-user-friends"></i>
                        <p>Aucun client enregistr√©</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Donn√©es des agents (en production, cela viendrait d'une base de donn√©es)
        const agents = [
            { username: "agent1", password: "esodi2024", name: "Koffi Mensah" },
            { username: "agent2", password: "esodi2024", name: "A√Øcha Bello" },
            { username: "admin", password: "admin123", name: "Administrateur ESODI" }
        ];
        
        // Stockage des clients (en production, cela viendrait d'une base de donn√©es)
        let clients = JSON.parse(localStorage.getItem('esodi_clients')) || [];
        
        // √âl√©ments DOM
        const loginContainer = document.getElementById('loginContainer');
        const dashboard = document.getElementById('dashboard');
        const loginForm = document.getElementById('loginForm');
        const errorMessage = document.getElementById('errorMessage');
        const logoutBtn = document.getElementById('logoutBtn');
        const userDisplayName = document.getElementById('userDisplayName');
        const clientForm = document.getElementById('clientForm');
        const clientsList = document.getElementById('clientsList');
        const monthFilter = document.getElementById('monthFilter');
        const clientsThisMonth = document.getElementById('clientsThisMonth');
        const totalClients = document.getElementById('totalClients');
        const activeServices = document.getElementById('activeServices');
        const getLocationBtn = document.getElementById('getLocationBtn');
        const gpsStatus = document.getElementById('gpsStatus');
        const latitudeInput = document.getElementById('latitude');
        const longitudeInput = document.getElementById('longitude');
        const sendWhatsAppBtn = document.getElementById('sendWhatsAppBtn');
        
        // Num√©ro WhatsApp ESODI
        const ESODI_WHATSAPP = "92871605";
        
        // V√©rifier si un utilisateur est d√©j√† connect√©
        const currentUser = JSON.parse(localStorage.getItem('esodi_current_user'));
        if (currentUser) {
            showDashboard(currentUser);
        }
        
        // G√©rer la connexion
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // V√©rifier les identifiants
            const agent = agents.find(a => a.username === username && a.password === password);
            
            if (agent) {
                // Connexion r√©ussie
                localStorage.setItem('esodi_current_user', JSON.stringify(agent));
                showDashboard(agent);
            } else {
                // √âchec de connexion
                errorMessage.style.display = 'block';
            }
        });
        
        // G√©rer la d√©connexion
        logoutBtn.addEventListener('click', function() {
            localStorage.removeItem('esodi_current_user');
            showLogin();
        });
        
        // G√©rer la g√©olocalisation
        getLocationBtn.addEventListener('click', function() {
            if (!navigator.geolocation) {
                gpsStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> La g√©olocalisation n\'est pas support√©e par votre navigateur';
                return;
            }
            
            gpsStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Localisation en cours...';
            getLocationBtn.disabled = true;
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    latitudeInput.value = lat.toFixed(6);
                    longitudeInput.value = lng.toFixed(6);
                    
                    gpsStatus.innerHTML = '<i class="fas fa-check-circle"></i> Position obtenue avec succ√®s!';
                    getLocationBtn.disabled = false;
                    
                    // Remplir automatiquement l'adresse si le champ est vide
                    if (!document.getElementById('clientAdresse').value) {
                        reverseGeocode(lat, lng);
                    }
                },
                function(error) {
                    let message = '';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            message = 'Localisation refus√©e par l\'utilisateur';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            message = 'Information de localisation indisponible';
                            break;
                        case error.TIMEOUT:
                            message = 'La demande de localisation a expir√©';
                            break;
                        default:
                            message = 'Une erreur inconnue est survenue';
                    }
                    gpsStatus.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
                    getLocationBtn.disabled = false;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        });
        
        // Fonction pour obtenir l'adresse √† partir des coordonn√©es (g√©ocodage invers√©)
        function reverseGeocode(lat, lng) {
            // Utilisation de l'API Nominatim (OpenStreetMap) pour le g√©ocodage invers√©
            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
                .then(response => response.json())
                .then(data => {
                    if (data && data.display_name) {
                        document.getElementById('clientAdresse').value = data.display_name;
                    }
                })
                .catch(error => {
                    console.log('Erreur de g√©ocodage invers√©:', error);
                });
        }
        
        // G√©rer l'enregistrement d'un nouveau client
        clientForm.addEventListener('submit', function(e) {
            e.preventDefault();
            saveClient();
        });
        
        // G√©rer l'envoi par WhatsApp
        sendWhatsAppBtn.addEventListener('click', function() {
            // Sauvegarder d'abord le client
            const client = saveClient(true);
            if (client) {
                // Envoyer par WhatsApp
                sendToWhatsApp(client);
            }
        });
        
        // Fonction pour sauvegarder un client
        function saveClient(silent = false) {
            // V√©rifier que la localisation GPS est disponible
            if (!latitudeInput.value || !longitudeInput.value) {
                if (!confirm("Aucune localisation GPS n'a √©t√© enregistr√©e. Voulez-vous continuer sans les coordonn√©es GPS?")) {
                    return null;
                }
            }
            
            const client = {
                id: Date.now(),
                nom: document.getElementById('clientNom').value,
                prenom: document.getElementById('clientPrenom').value,
                whatsapp: document.getElementById('clientWhatsApp').value,
                email: document.getElementById('clientEmail').value,
                etablissement: document.getElementById('clientEtablissement').value,
                adresse: document.getElementById('clientAdresse').value,
                service: document.getElementById('clientService').value,
                latitude: latitudeInput.value,
                longitude: longitudeInput.value,
                date: new Date().toISOString(),
                agent: currentUser.name
            };
            
            clients.push(client);
            localStorage.setItem('esodi_clients', JSON.stringify(clients));
            
            // Mettre √† jour l'affichage
            updateClientsDisplay();
            updateStats();
            
            // R√©initialiser le formulaire
            if (!silent) {
                clientForm.reset();
                latitudeInput.value = '';
                longitudeInput.value = '';
                gpsStatus.innerHTML = 'Cliquez pour obtenir les coordonn√©es GPS automatiquement';
                
                // Afficher un message de confirmation
                alert(`Client ${client.prenom} ${client.nom} enregistr√© avec succ√®s!`);
            }
            
            return client;
        }
        
        // Fonction pour envoyer les donn√©es par WhatsApp
        function sendToWhatsApp(client) {
            // Construire le message WhatsApp
            const message = `üìã *NOUVEAU CLIENT ESODI* üìã%0A%0A` +
                           `*üë§ Informations Client:*%0A` +
                           `‚Ä¢ Nom: ${client.nom}%0A` +
                           `‚Ä¢ Pr√©nom: ${client.prenom}%0A` +
                           `‚Ä¢ WhatsApp: ${client.whatsapp}%0A` +
                           `‚Ä¢ Email: ${client.email || 'Non renseign√©'}%0A%0A` +
                           `*üè¢ √âtablissement:*%0A` +
                           `‚Ä¢ Nom: ${client.etablissement}%0A` +
                           `‚Ä¢ Adresse: ${client.adresse || 'Non renseign√©e'}%0A` +
                           `‚Ä¢ Localisation: ${client.latitude && client.longitude ? `${client.latitude}, ${client.longitude}` : 'Non renseign√©e'}%0A%0A` +
                           `*üõ†Ô∏è Service Offert:*%0A` +
                           `‚Ä¢ Type: ${client.service}%0A%0A` +
                           `*üë®‚Äçüíº Agent ESODI:*%0A` +
                           `‚Ä¢ Nom: ${client.agent}%0A` +
                           `‚Ä¢ Date: ${new Date(client.date).toLocaleDateString('fr-FR')}%0A%0A` +
                           `_Enregistr√© automatiquement via l'application ESODI_`;
            
            // Cr√©er l'URL WhatsApp
            const whatsappUrl = `https://wa.me/${ESODI_WHATSAPP}?text=${message}`;
            
            // Ouvrir WhatsApp dans une nouvelle fen√™tre
            window.open(whatsappUrl, '_blank');
            
            // Afficher un message de confirmation
            alert(`Donn√©es du client envoy√©es par WhatsApp au ${ESODI_WHATSAPP}!`);
        }
        
        // G√©rer le filtre par mois
        monthFilter.addEventListener('change', updateClientsDisplay);
        
        // Afficher le tableau de bord
        function showDashboard(agent) {
            loginContainer.style.display = 'none';
            dashboard.style.display = 'block';
            userDisplayName.textContent = agent.name;
            
            updateClientsDisplay();
            updateStats();
            
            // D√©finir le filtre sur le mois actuel
            const currentMonth = new Date().getMonth();
            monthFilter.value = currentMonth.toString();
        }
        
        // Afficher l'√©cran de connexion
        function showLogin() {
            dashboard.style.display = 'none';
            loginContainer.style.display = 'block';
            loginForm.reset();
            errorMessage.style.display = 'none';
        }
        
        // Mettre √† jour l'affichage des clients
        function updateClientsDisplay() {
            const selectedMonth = monthFilter.value;
            let filteredClients = [...clients];
            
            // Filtrer par mois si n√©cessaire
            if (selectedMonth !== 'all') {
                filteredClients = clients.filter(client => {
                    const clientDate = new Date(client.date);
                    return clientDate.getMonth() === parseInt(selectedMonth);
                });
            }
            
            // Trier par date (du plus r√©cent au plus ancien)
            filteredClients.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Afficher les clients
            if (filteredClients.length > 0) {
                clientsList.innerHTML = '';
                
                filteredClients.forEach(client => {
                    const clientDate = new Date(client.date);
                    const formattedDate = clientDate.toLocaleDateString('fr-FR');
                    
                    const clientCard = document.createElement('div');
                    clientCard.className = 'client-card';
                    
                    let gpsInfo = '';
                    if (client.latitude && client.longitude) {
                        gpsInfo = `<div><strong>Localisation:</strong> ${client.latitude}, ${client.longitude}</div>`;
                    }
                    
                    clientCard.innerHTML = `
                        <div class="client-name">${client.prenom} ${client.nom}</div>
                        <div class="client-details">
                            <div><strong>√âtablissement:</strong> ${client.etablissement}</div>
                            <div><strong>Service:</strong> ${client.service}</div>
                            <div><strong>WhatsApp:</strong> ${client.whatsapp}</div>
                            <div><strong>Adresse:</strong> ${client.adresse || 'Non renseign√©e'}</div>
                            ${gpsInfo}
                            <div><strong>Date:</strong> ${formattedDate}</div>
                            <div><strong>Agent:</strong> ${client.agent}</div>
                        </div>
                    `;
                    
                    clientsList.appendChild(clientCard);
                });
            } else {
                clientsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-friends"></i>
                        <p>Aucun client enregistr√©</p>
                    </div>
                `;
            }
        }
        
        // Mettre √† jour les statistiques
        function updateStats() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            // Clients ce mois-ci
            const clientsThisMonthCount = clients.filter(client => {
                const clientDate = new Date(client.date);
                return clientDate.getMonth() === currentMonth && clientDate.getFullYear() === currentYear;
            }).length;
            
            // Total clients
            const totalClientsCount = clients.length;
            
            // Services actifs (estimation)
            const activeServicesCount = clients.length; // Simplification
            
            clientsThisMonth.textContent = clientsThisMonthCount;
            totalClients.textContent = totalClientsCount;
            activeServices.textContent = activeServicesCount;
        }
    </script>
</body>
</html>
